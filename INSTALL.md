# get splunk enterprise
	wget -O splunk-7.0.0-c8a78efdd40f-linux-2.6-x86_64.rpm 'https://www.splunk.com/bin/splunk/DownloadActivityServlet?architecture=x86_64&platform=linux&version=7.0.0&product=splunk&filename=splunk-7.0.0-c8a78efdd40f-linux-2.6-x86_64.rpm&wget=true'

# get splunk uf
	wget -O splunkforwarder-7.0.0-c8a78efdd40f-linux-2.6-x86_64.rpm 'https://www.splunk.com/bin/splunk/DownloadActivityServlet?architecture=x86_64&platform=linux&version=7.0.0&product=universalforwarder&filename=splunkforwarder-7.0.0-c8a78efdd40f-linux-2.6-x86_64.rpm&wget=true'

# install
	rpm -Uvh splunk-7.0.0-c8a78efdd40f-linux-2.6-x86_64.rpm
	rpm -Uvh splunkforwarder-7.0.0-c8a78efdd40f-linux-2.6-x86_64.rpm
	cp /opt/splunk
	wget http://download.splunk.com/misc/sdk/python/splunk-sdk-python-1.6.2.zip
	unzip splunk-sdk-python-1.6.2.zip
	ln -sf splunk-sdk-python-1.6.2 splunk-sdk-python

# git
	git clone https://github.com/1havran/es2esm.git
	cd es2esm

# poc
	cp -r sh/opt/splunk/etc/apps/end2end_app /opt/splunk/etc/apps
	cp -r sh/opt/splunk/etc/system/local/inputs.conf /opt/splunk/etc/system/local
	cp -r esm/opt/splunkforwarder/etc/system/local/{inputs,outputs}.conf /opt/splunkforwarder/etc/system/local

# start receiver in separate console
	python esm/receiver.py
![](https://github.com/1havran/es2esm/blob/master/screenshots/02.receiver.png)


# start splunk
	${sh/opt/splunk/.bash_profile | grep PYTHONPATH}
	cp sh/opt/splunk/.bash_profile /opt/splunk
	/opt/splunk/bin/splunk start --accept-license
	/opt/splunkforwarder/bin/splunk start --accept-license

# log to splunk
	chromium http://localhost:8000/en-US/app/end2end_app/search

# upstram random event using  "| sendevent"
	index=_internal | head 2 | table _time, source | sendevent
	# check on the console where receiver.py is running if the event has been received
![](https://github.com/1havran/es2esm/blob/master/screenshots/01.sendevent.png)

# ingest events manually
	search for:
	||a
	||b
	||c
	||d
	||e
	||f
	||d
	||g
	||g
![](https://github.com/1havran/es2esm/blob/master/screenshots/03.errorsearch.png)

	# The alert will be triggered in a minute in the Splunk GUI -> Activity -> Triggered Alerts
![](https://github.com/1havran/es2esm/blob/master/screenshots/04.alert.png)

	# Click on the alert to see the results
![](https://github.com/1havran/es2esm/blob/master/screenshots/05.alertdetail.png)

# search for all events received by the Receiver
	index=main source="esm_event_report_success" | table info_sid | dedup info_sid
	
	# Same events will be in the log files.
![](https://github.com/1havran/es2esm/blob/master/screenshots/06.alert_received.png)

	# You may notice, missed events are recorded in separate log file.
![](https://github.com/1havran/es2esm/blob/master/screenshots/07.alert_missed.png)

# search for alerts generated by the searchhead
	| rest /servicesNS/admin/end2end_app/alerts/fired_alerts/Failed%20Splunk%20Login | fields sid | rex field=sid "(?<info_sid>^.*)$" | fields info_sid | dedup info_sid 

# search for missing events:
	| rest /servicesNS/admin/end2end_app/alerts/fired_alerts/Failed%20Splunk%20Login | fields sid | rex field=sid "(?<info_sid>^.*)$" | fields info_sid | dedup info_sid | append [ search index=main source="esm_event_report_success" | table info_sid | dedup info_sid] | stats count by info_sid | search count<2
![](https://github.com/1havran/es2esm/blob/master/screenshots/09.splunk_missed_verified.png)

# eventreplay
	cd /opt/splunk/etc/apps/end2end_app/bin
	python eventreplay.py
![](https://github.com/1havran/es2esm/blob/master/screenshots/11.eventreplay.png)

	# receiver will display the events on the stdout
![](https://github.com/1havran/es2esm/blob/master/screenshots/12.eventreplay-receiver.png)

	# sometimes events must be replayed multiple times as receiver moves events to missed with 25% probability.
![](https://github.com/1havran/es2esm/blob/master/screenshots/13.eventreplay3.png)

	# this particular event was replayed by eventreplay.py 4 times. 3 times it was missed, last time it was considered as received.
![](https://github.com/1havran/es2esm/blob/master/screenshots/14.eventreplay3-receiver.png)

	# eventreplay.py and sendevent.py produces the audittrail as separate source in Splunk.
![](https://github.com/1havran/es2esm/blob/master/screenshots/15.splunk-summary.png)

# to schedule event replay
	cp es2esm/sh/etc/crontab /etc/cron.d/eventreplay
